<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ticket Orden #{{ order.id }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @media print { .no-print { display: none; } }
    .firma-linea {
      border-bottom: 1px solid #000;
      height: 18px;
    }
    .firma-label {
      font-size: 0.8rem;
      color: #555;
    }
  </style>
</head>
<body class="p-4">

  <!-- Botón imprimir solo en pantalla -->
  <div class="no-print mb-3">
    <button class="btn btn-dark" onclick="window.print()">Imprimir</button>
  </div>

  <div class="container">

    <!-- Encabezado con logo + empresa -->
    <div class="d-flex justify-content-between align-items-start mb-2">
      <div>
        <h4 class="mb-1">{{ settings.empresa or 'Orden de Servicio' }} — #{{ order.id }}</h4>
        <div class="text-muted small">
          {{ settings.direccion }} · {{ settings.telefono }} · {{ settings.email }}
        </div>
      </div>

      {% if settings.logo_filename %}
        <img
          src="{{ url_for('static', filename='uploads/' ~ settings.logo_filename) }}"
          alt="logo"
          style="height:64px"
        >
      {% endif %}
    </div>

    <hr class="mt-2 mb-2">

    <!-- Cliente + QR -->
    <div class="row align-items-start">
      <div class="col-7">
        <h6 class="mb-1">Cliente</h6>
        <p class="mb-1"><strong>{{ order.client.nombre }}</strong></p>
        <p class="mb-1">
          {{ order.client.telefono or 'Sin teléfono' }}
          ·
          {{ order.client.email or 'Sin email' }}
        </p>
        <p class="mb-1">{{ order.client.direccion }}</p>
        <p class="mb-1">
          <strong>DNI:</strong> {{ order.client.dni or '—' }}
        </p>
      </div>
      <div class="col-5 text-end">
        <div class="mb-1">
          <img
            src="{{ url_for('order_qr_png', order_id=order.id) }}"
            alt="QR"
            style="height:96px"
          >
        </div>
        <div class="small text-muted">
          Escaneá el QR para ver el estado de la orden.
        </div>
      </div>
    </div>

    <hr class="mt-2 mb-2">

    <!-- Equipo + diagnóstico -->
    <div class="row">
      <div class="col-6">
        <p class="mb-1">
          <strong>Equipo:</strong>
          {{ order.marca }} {{ order.modelo }}
        </p>
        <p class="mb-1">
          <strong>IMEI:</strong>
          {{ order.imei or '—' }}
        </p>
        <p class="mb-1">
          <strong>Accesorios:</strong>
          {{ order.accesorios or '—' }}
        </p>
        <p class="mb-1">
          <strong>Clave/Patrón:</strong>
          {{ order.clave_desbloqueo or '—' }}
        </p>
      </div>
      <div class="col-6">
        <p class="mb-1">
          <strong>Problema reportado:</strong><br>
          {{ order.problema_reportado }}
        </p>
        <p class="mb-1">
          <strong>Diagnóstico:</strong><br>
          {{ order.diagnostico or '—' }}
        </p>
        <p class="mb-1">
          <strong>Estado:</strong>
          {{ order.estado_label() }}
        </p>
        <p class="mb-1">
          <strong>Ingreso:</strong>
          {{ order.created_at.strftime("%d/%m/%Y %H:%M") }}
        </p>
      </div>
    </div>

    <hr class="mt-2 mb-2">

    <!-- Costos -->
    <p class="mb-2">
      <strong>Costo estimado:</strong>
      {{ ('AR$ %.2f' % order.costo_estimado) if order.costo_estimado is not none else '—' }}
      ·
      <strong>Seña:</strong>
      {{ ('AR$ %.2f' % order.senia) if order.senia else '—' }}
    </p>

    <!-- Condiciones / Garantía -->
    {% if settings.condiciones %}
      <div class="small text-muted mb-3">
        {{ settings.condiciones | replace('\n', '<br>') | safe }}
      </div>
    {% endif %}

    <!-- Firma del cliente -->
    <div class="mt-3">
      <div class="row g-3">
        <div class="col-6">
          <div class="firma-linea"></div>
          <div class="firma-label">Firma del cliente</div>
        </div>
        <div class="col-3">
          <div class="firma-linea"></div>
          <div class="firma-label">DNI</div>
        </div>
        <div class="col-3">
          <div class="firma-linea"></div>
          <div class="firma-label">Fecha</div>
        </div>
      </div>
      <div class="mt-2 small text-muted">
        Al firmar, el cliente declara haber leído y aceptado las condiciones detalladas en este comprobante.
      </div>
    </div>

  </div>
</body>
</html>
